<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <style>
        html, body
        {
            padding: 0;
            margin: 0;
            overflow: hidden;
            height:100%;
            
        }
        body
        {
          display: flex;
          justify-content: center;
          align-items: center;
        }
        canvas
        {
          border: 2px solid dodgerBlue;
        }
        
        #mylog
        {
          position: absolute;
          left: 0;
          top: 0;
          height: 50%;
          overflow-y: scroll;
          border: 2px solid black;
          width: 30%;
        }
    </style>
    <script>
    
    
    var objects = [];
    var floor = {
      
    };
    
    class PhysicalObject
    {
      constructor(x, y, mass, xVelocity, yVelocity, xAcceleration, yAcceleration, elasticity, color)
      {
        this.x = x;
        this.y = y;
        this.mass = mass;
        this.xVelocity = xVelocity;
        this.yVelocity = yVelocity;
        this.xAcceleration = xAcceleration;
        this.yAcceleration = yAcceleration;
        this.elasticity = elasticity;
        this.color = color;
      }
      
      setX( x ) { this.x = x; return x; }
      setY( y ) { this.y = y; return y; }
      setMass( mass ) { this.mass = mass; return mass; }
      setXVelocity( xVelocity ) { this.xVelocity = xVelocity; return xVelocity; }
      setYVelocity( yVelocity ) { this.yVelocity = yVelocity; return yVelocity; }
      setXAcceleration( xAcceleration ) { this.xAcceleration = xAcceleration; return xAcceleration; }
      setYAcceleration( yAcceleration ) { this.yAcceleration = yAcceleration; return yAcceleration; }
      setElasticity( elasticity ) { this.elasticity = elasticity; return elasticity; }
      setColor( color ) { this.color = color; return color; }
      
    }
    
    class Ball extends PhysicalObject
    {
      /*
      constructor({radius, x, y, mass, xVelocity, yVelocity, xAcceleration, yAcceleration, elasticity, color})
      {
        constructor(radius, x, y, mass, xVelocity, yVelocity, xAcceleration, yAcceleration, elasticity, color);
      }
      */
      constructor({radius = 5, x = 0, y = 0, mass = 100, xVelocity = 0, yVelocity = 0, xAcceleration = 0, yAcceleration = 9.8, elasticity = 0.5, color = "#000000"})
      {
        super(x, y, mass, xVelocity, yVelocity, xAcceleration, yAcceleration, elasticity, color);
        this.radius = radius;
      }
      
      draw()
      {
        ctx.strokeStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
        ctx.stroke();
      }
      
      setRadius( radius ) { this.radius = radius; return radius; }
      
    }
    
    var ball = new Ball({
      radius: 50,
      
    });
    var ball2 = new Ball({
      radius: 10,
      x: 100,
      y: 50,
      color: "#FF00FF"
    });
    var ball3 = new Ball({
      radius: 10,
      x: 150,
      y: 50,
      yVelocity: -50,
      yAcceleration: 98,
      color: "#FF0000"
    });
    
    objects.push(ball2);
    
    objects.push(ball3);
    objects.push(ball);
    // const g = {direction: 0, magnitude: 9.8};
    var canvas;
    var ctx;
        $( document ).ready(function()
        {
              var baseLogFunction = console.log;
          console.log = function(){
              baseLogFunction.apply(console, arguments);
      
              var args = Array.prototype.slice.call(arguments);
              for(var i=0;i<args.length;i++){
                  var node = createLogNode(args[i]);
                  document.querySelector("#mylog").appendChild(node);
              }
      
          }
      
          function createLogNode(message){
              var node = document.createElement("div");
              var textNode = document.createTextNode(message);
              node.appendChild(textNode);
              return node;
          }
      
          window.onerror = function(message, url, linenumber) {
              console.log("JavaScript error: " + message + " on line " +
                  linenumber + " for " + url);
          }
          
      console.log("test");
      console.log("test");
      //console.log("the error below is intentional to test error handling");
      //throw new Error("Test Error");
    
              canvas = document.getElementById("main-canvas");
              render();
              function render()
              {
                const dimensions = getObjectFitSize(
                  true,
                  canvas.clientWidth,
                  canvas.clientHeight,
                  canvas.width,
                  canvas.height
                );
                canvas.width = dimensions.width;
                canvas.height = dimensions.height;
                ctx = canvas.getContext("2d");
                updateCanvas( objects );
              }
              
            // adapted from: https://www.npmjs.com/package/intrinsic-scale
            function getObjectFitSize(
              contains /* true = contain, false = cover */,
              containerWidth,
              containerHeight,
              width,
              height
            ) {
              var doRatio = width / height;
              var cRatio = containerWidth / containerHeight;
              var targetWidth = 0;
              var targetHeight = 0;
              var test = contains ? doRatio > cRatio : doRatio < cRatio;
            
              if (test) {
                targetWidth = containerWidth;
                targetHeight = targetWidth / doRatio;
              } else {
                targetHeight = containerHeight;
                targetWidth = targetHeight * doRatio;
              }
            
              return {
                width: targetWidth,
                height: targetHeight,
                x: (containerWidth - targetWidth) / 2,
                y: (containerHeight - targetHeight) / 2
              };
            }
        
            
            // may not be nec while setTimeout on fixed interval..
            var start = performance.now();
            var end;
            
            setInterval(() => {
                end = performance.now();
                updateBall( (end - start) / 1000, objects);
                start = end;
            }, 17 /* runs about 59 times per second */);
            

        });

        function updateBall ( timePassed, objects )
        {
            objects.forEach(object => {
                object.yVelocity += object.yAcceleration * timePassed;
                object.y += object.yVelocity * timePassed;
                object.xVelocity +=object.xAcceleration * timePassed;
                object.x += object.xVelocity * timePassed;
            if(object.y + object.radius >= canvas.height)
            {
                object.yVelocity *= -object.elasticity;
                object.y = canvas.height - object.radius;
            }
            });
            checkCollisions( objects );
            //console.log(timePassed);
            updateCanvas( objects );
        }
        
        function checkCollisions( objects )
        {
          if(objects.length === 1) return;
          for (let i = 0; i < objects.length; i++)
          {
            for (let j = i + 1; j < objects.length; j++)
            {
              const obj1 = objects[i];
              const obj2 = objects[j];
              if (detectCollision(obj1, obj2))
              {
                handleCollision(obj1, obj2);
              }
            }
          }
        }
        
        function updateCanvas( objects )
        {
          
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            objects.forEach(object => {
              object.draw();
            });
            }
        
        function detectCollision(obj1, obj2)
        {
          const distance = Math.sqrt(Math.pow(obj2.x - obj1.x, 2) + Math.pow(obj2.y - obj1.y, 2));
          if (distance <= obj1.radius + obj2.radius)
          {
            obj1.color = "#0000FF";
            obj2.color = "#0000FF";
            return true;
          }
          return false;
        }

        
        function handleCollision(obj1, obj2) 
        {
          
        }
    </script>
</head>
<body>
    <canvas id="main-canvas">
    </canvas>
    <div id="mylog"></div>
</body>
</html>
